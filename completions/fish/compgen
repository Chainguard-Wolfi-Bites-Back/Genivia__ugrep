#!/bin/sh

cat > ug.tmp <<END 
# Autogenerated from ugrep --help
# Copy this file to ~/.config/fish/completions
END

../../src/ugrep --help 2>&1 \
    | sed -E -e '/^[ ]{4}-/s/ -([^-])([[ ][^ ]*|,|$)/ -s \1/g' -e $'/^[ ]{4}-/s/ -([^-][^-, ]+)/ -o \'\\1\'/g' -e '/^[ ]{4}-/s/--([-a-z]+)[^ ]*/-l \1/g' -e '/^[ ]{4}-/s/$/ -d/' \
    | sed -E -e '/^[ ]{4}-/s/ \[-e\] PATTERN| \[OPTIONS\]| \[WHAT\],| \.\.\.|,//g' \
    | sed -E -e $'/^[ ]{4}-/s/-s ([^0-9A-Za-z])/-s \'\\1\'/g' \
    | sed -E -e '/^[ ]{4}-/,/^[ ]{12}.*\./!d' -e 's/^([ ]{12}[^.]*\.)( .*)?$/\1/' -e $'/^[ ]{12}/s/[`\']//g' -e 's/^[ ]{4}//' \
    | sed -e :a -e '$!N;s/\n[ ]\{7\}//;ta' -e 'P;D' \
    | sed -e $'s/ -d / -d \'/' -e $'s/$/\'/' \
    >> ug.tmp

cat ug.tmp | sed -e '/^[^#]/s/^/complete -c ug /' > ug.fish
cat ug.tmp | sed -e '/^[^#]/s/^/complete -c ug+ /' > ug+.fish
cat ug.tmp | sed -e '/^[^#]/s/^/complete -c ugrep /' > ugrep.fish
cat ug.tmp | sed -e '/^[^#]/s/^/complete -c ugrep+ /' > ugrep+.fish

cat ug.tmp
rm -f ug.tmp
